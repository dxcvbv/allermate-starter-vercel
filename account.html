<!doctype html><html><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Account — AllerMate</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/app.css"/></head><body><header class="header">
  <div class="container bar">
  <a href="index.html" class="brand">
  <img src="assets/logo.png" alt="AllerMate logo" height="28" style="display:block">
</a>
    <nav aria-label="Primary" class="desktop-only">
      <a href="index.html">Home</a>
      <a href="search.html">Search</a>
      <a href="account.html">Account</a>
      <a href="history.html">History</a>
      <a href="signin.html">Sign In</a>
    </nav>
    <button class="mobile-only button ghost" id="menuBtn" aria-label="Open menu">Menu</button>
  </div>
</header>
<section class="container" style="padding:36px 0">
  <div class="card" style="max-width:900px;margin:0 auto">
    <h1>Your Profile</h1>
    <div class="grid two">
      <div><label for="allergies">Allergies</label><input id="allergies" class="input" placeholder="peanut, sesame, egg"/></div>
      <div><label for="intolerances">Intolerances</label><input id="intolerances" class="input" placeholder="lactose, gluten"/></div>
      <div><label for="diet">Diet</label><select id="diet" class="input"><option>None</option><option>Vegetarian</option><option>Vegan</option><option>Pescatarian</option></select></div>
      <div><label for="epi">Epinephrine auto‑injector</label><select id="epi" class="input"><option>No</option><option>Yes</option></select></div>
      <div style="grid-column:1/-1"><label for="subs">Preferred substitutions</label><input id="subs" class="input" placeholder="e.g., oat milk instead of dairy"/></div>
      <div style="grid-column:1/-1"><label for="notes">Notes</label><textarea id="notes" class="input" rows="4" placeholder="Anything else you'd like us to consider"></textarea></div>
    </div>
    <div class="actions" style="margin-top:12px">
      <button id="saveProfile" class="button">Save profile</button>
      <a id="signOut" class="button ghost" href="#">Sign out</a>
      <a class="button ghost" href="index.html">← Home</a>
    </div>
  </div>
</section>
<footer class="footer">
  <div class="container row" style="justify-content:space-between">
    <div>© <span id="y"></span> AllerMate</div>
    <div class="links">
      <a href="index.html">Home</a>
      <a href="search.html">Search</a>
      <a href="account.html">Account</a>
      <a href="history.html">History</a>
      <a href="signin.html">Sign In</a>
    </div>
  </div>
  <script>document.getElementById('y').textContent=new Date().getFullYear()</script>
</footer>
<nav class="tabbar" aria-label="Bottom navigation">
  <a href="index.html">Home</a>
  <a href="search.html">Search</a>
  <a href="account.html">Account</a>
  <a href="history.html">History</a>
</nav>
<script>
window.SUPABASE_URL='https://iabawpqxcoxfstyaufui.supabase.co';
window.SUPABASE_ANON_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYmF3cHF4Y294ZnN0eWF1ZnVpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMjA3ODMsImV4cCI6MjA3NzY5Njc4M30.6jPNWec0EZMawGRFa9Jz2nehztHIFVvwER8Ljh-HK9g';
</script>
<script type="module" src="js/supa.js"></script>
<script type="module" src="js/app.js"></script>

<script type="module">
  import { requireUser, loadProfile, saveProfile, signOut } from './js/supa.js';
  import { toast } from './js/app.js';
  const $ = s => document.querySelector(s);
  const val = s => (document.querySelector(s)?.value ?? '').trim();
  document.addEventListener('DOMContentLoaded', async () => {
    await requireUser();
    const p = await loadProfile();
    if (p) {
      $('#allergies').value = p.allergies || '';
      $('#intolerances').value = p.intolerances || '';
      $('#diet').value = p.diet || 'None';
      $('#epi').value = p.epi ? 'Yes' : 'No';
      $('#subs').value = p.subs || '';
      $('#notes').value = p.notes || '';
    }
  });
  document.getElementById('saveProfile').addEventListener('click', async () => {
    const payload = {
      allergies: val('#allergies'), intolerances: val('#intolerances'),
      diet: val('#diet'), epi: (val('#epi') || '').toLowerCase() === 'yes',
      subs: val('#subs'), notes: val('#notes')
    };
    try { await saveProfile(payload); toast('Saved to your account.'); } catch(e){ toast('Save failed'); }
  });
  document.getElementById('signOut').addEventListener('click', async (e)=>{ e.preventDefault(); await signOut(); location.href='signin.html'; });
</script>
</body></html>
