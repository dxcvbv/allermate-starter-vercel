<!doctype html><html><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Search Your Area</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
</head><body>
<div class="topbar"></div>
<div class="container">
  <h1>Search Your Area (Mapbox)</h1>
  <div class="tools">
    <input id="q" class="input" placeholder="Type: restaurant, burger, pizza…" style="flex:1;min-width:240px"/>
    <button id="loc" class="button">Use my location</button>
    <button id="search" class="button">Search</button>
  </div>
  <div id="map"></div>
</div>
<script>
let map=L.map('map').setView([25.2048,55.2708],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
let layer=L.layerGroup().addTo(map);

function add(features){layer.clearLayers();(features||[]).forEach(f=>{const [lon,lat]=f.center;L.marker([lat,lon]).addTo(layer).bindPopup(`<b>${f.text||'Place'}</b><br>${f.place_name||''}`)})}

async function search(){
  const c=map.getCenter();const q=document.getElementById('q').value.trim()||'restaurant';
  const r=await fetch(`/api/places?lat=${c.lat}&lng=${c.lng}&q=${encodeURIComponent(q)}`);
  const data=await r.json();if(data.error){alert('API error: '+data.error);return} add(data.places);
}
document.getElementById('search').onclick=search;
document.getElementById('loc').onclick=()=>{navigator.geolocation.getCurrentPosition(p=>{map.setView([p.coords.latitude,p.coords.longitude],14);search();},()=>alert('Location denied—pan the map then Search.'))};
search();
</script></body></html>