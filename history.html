<!doctype html><html><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>History — AllerMate</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/app.css"/></head><body><header class="header">
  <div class="container bar">
    <a href="index.html" class="brand"><img src="assets/logo.svg" alt="AllerMate logo" height="28"></a>
    <nav aria-label="Primary" class="desktop-only">
      <a href="index.html">Home</a>
      <a href="search.html">Search</a>
      <a href="account.html">Account</a>
      <a href="history.html">History</a>
      <a href="signin.html">Sign In</a>
    </nav>
    <button class="mobile-only button ghost" id="menuBtn" aria-label="Open menu">Menu</button>
  </div>
</header>
<section class="container" style="padding:36px 0">
  <div class="card" style="max-width:980px;margin:0 auto">
    <h1>History</h1>
    <div class="grid two">
      <div><label for="date">Date</label><input id="date" type="date" class="input"/></div>
      <div><label for="food">Food</label><input id="food" class="input" placeholder="e.g., Pad Thai"/></div>
      <div><label for="trigger">Trigger</label><input id="trigger" class="input" placeholder="e.g., peanut oil"/></div>
      <div><label for="severity">Severity</label><select id="severity" class="input"><option>Mild</option><option>Moderate</option><option>Severe</option></select></div>
      <div style="grid-column:1/-1"><label for="notes">Notes</label><input id="notes" class="input" placeholder="What happened, actions taken"/></div>
    </div>
    <div class="actions" style="margin-top:12px">
      <button id="addEntry" class="button">Add entry</button>
      <a class="button ghost" href="index.html">← Home</a>
    </div>
    <hr style="border:none;border-top:1px solid rgba(255,255,255,.12);margin:16px 0"/>
    <div id="list" class="list"></div>
  </div>
</section>
<footer class="footer">
  <div class="container row" style="justify-content:space-between">
    <div>© <span id="y"></span> AllerMate</div>
    <div class="links">
      <a href="index.html">Home</a>
      <a href="search.html">Search</a>
      <a href="account.html">Account</a>
      <a href="history.html">History</a>
      <a href="signin.html">Sign In</a>
    </div>
  </div>
  <script>document.getElementById('y').textContent=new Date().getFullYear()</script>
</footer>
<nav class="tabbar" aria-label="Bottom navigation">
  <a href="index.html">Home</a>
  <a href="search.html">Search</a>
  <a href="account.html">Account</a>
  <a href="history.html">History</a>
</nav>
<script>
window.SUPABASE_URL='https://iabawpqxcoxfstyaufui.supabase.co';
window.SUPABASE_ANON_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYmF3cHF4Y294ZnN0eWF1ZnVpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMjA3ODMsImV4cCI6MjA3NzY5Njc4M30.6jPNWec0EZMawGRFa9Jz2nehztHIFVvwER8Ljh-HK9g';
</script>
<script type="module" src="js/supa.js"></script>
<script type="module" src="js/app.js"></script>

<script type="module">
  import { requireUser, listHistory, addHistory } from './js/supa.js';
  import { toast } from './js/app.js';
  const $ = s => document.querySelector(s);
  document.addEventListener('DOMContentLoaded', async ()=>{
    await requireUser();
    const t = new Date().toISOString().slice(0,10);
    $('#date').value = t;
    await renderHistory();
  });
  async function renderHistory(){
    const items = await listHistory();
    const el = $('#list');
    if (!items.length){ el.innerHTML = '<div class="item muted">No entries yet.</div>'; return; }
    el.innerHTML = items.map(r => `
      <div class="item">
        <div class="row" style="justify-content:space-between">
          <strong>${r.date}</strong><span class="muted">${r.severity || '—'}</span>
        </div>
        <div>${r.food || ''}</div>
        <div class="muted">${r.trigger || ''}</div>
        ${r.notes ? `<div class="muted">${r.notes}</div>` : ''}
      </div>`).join('');
  }
  document.getElementById('addEntry').addEventListener('click', async ()=>{
    const payload = { date: $('#date').value, food: $('#food').value, trigger: $('#trigger').value,
      severity: $('#severity').value, notes: $('#notes').value };
    try { await addHistory(payload); toast('Entry added'); await renderHistory(); } catch{ toast('Could not add entry'); }
  });
</script>
</body></html>
